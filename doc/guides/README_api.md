# Mãƒ»S CFD App - API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Mãƒ»S CFD App ã® RESTful API ã«é–¢ã™ã‚‹è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### ğŸ“‹ [api_specification.md](./api_specification.md)
**APIä»•æ§˜æ›¸ - å®Œå…¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹**

å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è©³ç´°ãªæŠ€è¡“ä»•æ§˜æ›¸ã§ã™ã€‚

**å†…å®¹:**
- å…¨27å€‹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°ä»•æ§˜
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
- èªè¨¼ãƒ»èªå¯è¦ä»¶
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±

**å¯¾è±¡èª­è€…:** ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã€APIåˆ©ç”¨è€…ã€ãƒ†ã‚¹ã‚¿ãƒ¼

## APIæ¦‚è¦

### ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- **èªè¨¼æ–¹å¼**: Cookieèªè¨¼ + AWS Cognito
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: HTTP-only Cookieï¼ˆ24æ™‚é–“æœ‰åŠ¹ï¼‰
- **æ¨©é™åˆ¶å¾¡**: ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆadmin/userï¼‰

### ğŸ“Š APIã‚«ãƒ†ã‚´ãƒª

| ã‚«ãƒ†ã‚´ãƒª | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•° | ä¸»è¦æ©Ÿèƒ½ |
|----------|-----------------|----------|
| **èªè¨¼ç³»** | 3å€‹ | ãƒ­ã‚°ã‚¤ãƒ³ã€èªè¨¼æƒ…å ±å–å¾—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†** | 8å€‹ | CRUDã€æ‰¿èªã€åœæ­¢ã€å‰Šé™¤ |
| **å–å¼•ç®¡ç†** | 2å€‹ | å±¥æ­´å–å¾—ã€å–å¼•ä½œæˆ |
| **ç›¸å ´ç®¡ç†** | 3å€‹ | ä¾¡æ ¼å±¥æ­´ã€ä¾¡æ ¼è¨­å®šã€æœ€æ–°ä¾¡æ ¼ |
| **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«** | 2å€‹ | å–å¾—ã€æ›´æ–° |
| **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** | 1å€‹ | çµ±åˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | 1å€‹ | ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |

### ğŸš€ ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ğŸ”‘ èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³
```http
POST /api/auth/login           # ãƒ­ã‚°ã‚¤ãƒ³
GET  /api/auth/me             # ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
POST /api/auth/change-password # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
```

#### ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
```http
GET  /api/users               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
POST /api/users               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
POST /api/users/{id}/approve  # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ‰¿èª
POST /api/users/{id}/suspend  # ãƒ¦ãƒ¼ã‚¶ãƒ¼åœæ­¢
```

#### ğŸ’° å–å¼•ç®¡ç†
```http
GET  /api/transactions        # å–å¼•å±¥æ­´å–å¾—
POST /api/transactions        # å–å¼•ä½œæˆï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
```

#### ğŸ“ˆ ç›¸å ´ç®¡ç†
```http
GET  /api/market-rates        # ç›¸å ´å±¥æ­´
POST /api/market-rates        # ç›¸å ´ä¾¡æ ¼è¨­å®šï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
GET  /api/market-rates/latest # æœ€æ–°ç›¸å ´ï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯ï¼‰
```

## ãƒ‡ãƒ¼ã‚¿å½¢å¼

### ğŸ“ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼
- **Content-Type**: `application/json`
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: `multipart/form-data`
- **èªè¨¼**: Cookieè‡ªå‹•é€ä¿¡

### ğŸ“¤ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
```typescript
// æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  success: true,
  data: T,           // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿
  message?: string   // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}

// ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  statusCode: number,
  statusMessage: string
}

// ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  success: true,
  data: {
    items: T[],
    total: number,
    page: number,
    limit: number,
    hasMore: boolean
  }
}
```

## èªè¨¼ãƒ»èªå¯

### ğŸ” æ¨©é™ãƒ¬ãƒ™ãƒ«

| ãƒ­ãƒ¼ãƒ« | æ¨©é™ | èª¬æ˜ |
|--------|------|------|
| **admin** | å…¨æ¨©é™ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€å–å¼•ä½œæˆã€ç›¸å ´è¨­å®šãŒå¯èƒ½ |
| **user** | é™å®šæ¨©é™ | è‡ªèº«ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»å–å¼•å±¥æ­´ã®é–²è¦§ã®ã¿ |

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½
- **Cookieèªè¨¼**: HTTP-only, Secure, SameSite=Strict
- **æ¨©é™ãƒã‚§ãƒƒã‚¯**: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§ã®ç´°ã‹ã„æ¨©é™åˆ¶å¾¡
- **å…¥åŠ›æ¤œè¨¼**: å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

## é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ

### ğŸ§ª ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

| ç¨®åˆ¥ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | æ¨©é™ |
|------|---------------|------------|------|
| **ç®¡ç†è€…** | admin@example.com | TempPass123! | admin |
| **ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼** | user@example.com | password123 | user |

### ğŸ”§ é–‹ç™ºç’°å¢ƒ
- **ãƒ­ãƒ¼ã‚«ãƒ«**: `http://localhost:3000/api`
- **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼**: `https://dev.your-domain.com/api`

### ğŸ“‹ APIãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### èªè¨¼ç³»
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸãƒ»å¤±æ•—
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ï¼ˆæˆåŠŸãƒ»å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒšãƒ¼ã‚¸ãƒ³ã‚°ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å«ã‚€ï¼‰
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ‰¿èªãƒ»æ‹’å¦
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼åœæ­¢ãƒ»å‰Šé™¤

#### å–å¼•ç®¡ç†
- [ ] å–å¼•å±¥æ­´å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰
- [ ] å–å¼•ä½œæˆï¼ˆæ®‹é«˜ãƒã‚§ãƒƒã‚¯å«ã‚€ï¼‰
- [ ] æ®‹é«˜è¨ˆç®—ã®æ­£ç¢ºæ€§

#### ç›¸å ´ç®¡ç†
- [ ] ç›¸å ´ä¾¡æ ¼è¨­å®š
- [ ] ä¾¡æ ¼å±¥æ­´å–å¾—
- [ ] æœ€æ–°ä¾¡æ ¼å–å¾—

## APIåˆ©ç”¨ä¾‹

### JavaScript/TypeScriptä¾‹

```typescript
// ãƒ­ã‚°ã‚¤ãƒ³
const login = async (email: string, password: string) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password }),
    credentials: 'include' // Cookieé€ä¿¡ã«å¿…è¦
  });
  return response.json();
};

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
const getUsers = async (page = 1, limit = 20) => {
  const response = await fetch(`/api/users?page=${page}&limit=${limit}`, {
    credentials: 'include'
  });
  return response.json();
};

// å–å¼•ä½œæˆ
const createTransaction = async (data: TransactionCreateForm) => {
  const response = await fetch('/api/transactions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
    credentials: 'include'
  });
  return response.json();
};
```

### curlä¾‹

```bash
# ãƒ­ã‚°ã‚¤ãƒ³
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"TempPass123!"}' \
  -c cookies.txt

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
curl -X GET http://localhost:3000/api/users \
  -b cookies.txt

# ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
curl -X POST http://localhost:3000/api/upload/image \
  -F "file=@profile.jpg" \
  -b cookies.txt
```

## ã‚¨ãƒ©ãƒ¼å¯¾å¿œ

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦æ³• |
|--------|------|--------|
| `401 Unauthorized` | æœªèªè¨¼ | ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ |
| `403 Forbidden` | æ¨©é™ä¸è¶³ | ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªæ“ä½œ |
| `400 Bad Request` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèª |
| `404 Not Found` | ãƒªã‚½ãƒ¼ã‚¹æœªå­˜åœ¨ | URLã‚„IDã‚’ç¢ºèª |

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›®æ¨™
- **èªè¨¼API**: < 500ms
- **ãƒ‡ãƒ¼ã‚¿å–å¾—**: < 1000ms
- **ãƒ‡ãƒ¼ã‚¿æ›´æ–°**: < 1500ms
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: < 5000ms

### ğŸ”„ ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ¨å¥¨
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»¶æ•°**: 20ä»¶
- **æœ€å¤§ä»¶æ•°**: 100ä»¶
- **å¤§é‡ãƒ‡ãƒ¼ã‚¿**: å¿…ãšãƒšãƒ¼ã‚¸ãƒ³ã‚°ä½¿ç”¨

## é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

### ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
```
/server/api/
â”œâ”€â”€ auth/              # èªè¨¼ç³»API
â”œâ”€â”€ users/             # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API
â”œâ”€â”€ transactions/      # å–å¼•ç®¡ç†API
â”œâ”€â”€ market-rates/      # ç›¸å ´ç®¡ç†API
â”œâ”€â”€ profile/           # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«API
â”œâ”€â”€ dashboard/         # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰API
â””â”€â”€ upload/            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰API

/types/
â””â”€â”€ index.ts           # TypeScriptå‹å®šç¾©

/doc/
â”œâ”€â”€ database_specification.md  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜
â””â”€â”€ er_diagram.md             # ERå›³
```

### ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜æ›¸](./database_specification.md)
- [ERå›³](./er_diagram.md)
- [ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸](./system_specification.md)

## ã‚µãƒãƒ¼ãƒˆãƒ»å•ã„åˆã‚ã›

- **é–‹ç™ºãƒãƒ¼ãƒ **: ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ 
- **æ›´æ–°æ—¥**: 2024å¹´1æœˆ28æ—¥
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

**ğŸ“ Note**: ã“ã® API ã¯é–‹ç™ºä¸­ã®ãŸã‚ã€ä»•æ§˜ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æœ€æ–°ã®æƒ…å ±ã¯ [api_specification.md](./api_specification.md) ã‚’ã”ç¢ºèªãã ã•ã„ã€‚