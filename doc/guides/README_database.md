# BTC Mock App - データベースドキュメント

## 概要

このディレクトリには、BTC Mock Appのデータベース設計に関する包括的なドキュメントが含まれています。

## ドキュメント一覧

### 📋 [database_specification.md](./database_specification.md)
**DynamoDBデータベース設計仕様書**

詳細な技術仕様を含む包括的なドキュメントです。

**内容:**
- 全5テーブルの詳細フィールド定義
- インデックス設計（GSI含む）
- AWS Cognito認証システム設計
- S3ファイルストレージ設計
- セキュリティ・権限管理システム
- データアクセスパターン
- パフォーマンス設計指針
- 運用・保守ガイドライン

**対象読者:** 開発者、インフラエンジニア、システム管理者

### 🗺️ [er_diagram.md](./er_diagram.md)
**エンティティ関係図（ER図）**

視覚的なデータベース構造とエンティティ間関係の説明です。

**内容:**
- Mermaidで描画されたER図
- エンティティ詳細説明
- データフロー図
- セキュリティ・権限マトリックス
- インデックス設計概要

**対象読者:** 全ステークホルダー

## データベース構成

### 🗄️ メインテーブル（5テーブル）

| テーブル名 | 用途 | 主要機能 |
|-----------|------|----------|
| **Users** | ユーザー管理 | プロフィール、認証情報、承認状態 |
| **Transactions** | 取引履歴 | BTC入出金記録、残高計算 |
| **Market_rates** | 相場管理 | BTC/JPY価格履歴、時系列データ |
| **Sessions** | セッション管理 | ログイン状態、セキュリティ監視 |
| **Permissions** | 権限管理 | ロールベースアクセス制御 |

### 🔐 認証・認可システム

| コンポーネント | 技術 | 役割 |
|----------------|------|------|
| **認証** | AWS Cognito User Pool | ユーザー認証、パスワード管理 |
| **認可** | カスタム権限システム | ロールベースアクセス制御 |
| **セッション** | DynamoDB + TTL | セッション管理、自動期限切れ |

### 💾 ストレージシステム

| タイプ | 技術 | 用途 |
|--------|------|------|
| **データベース** | DynamoDB | 構造化データ、高速アクセス |
| **ファイル** | S3 | プロフィール画像、ドキュメント |
| **キャッシュ** | アプリケーション層 | セッション、権限、相場価格 |

## 主要な設計パターン

### 1. 📊 NoSQL設計
- **パーティションキー**: 効率的なデータ分散
- **ソートキー**: 範囲クエリ対応
- **GSI**: 多様なアクセスパターン対応

### 2. 🔍 インデックス戦略
- **UserTimestampIndex**: ユーザー別取引履歴
- **TimestampIndex**: 時系列価格データ
- **UserSessionIndex**: セッション管理

### 3. 🛡️ セキュリティ設計
- **最小権限の原則**: IAMロール設計
- **データ暗号化**: 保存時・転送時暗号化
- **監査ログ**: 全操作の追跡可能性

## 開発・運用フロー

### 🚀 開発フェーズ
1. **テーブル作成**: Terraformによる自動作成
2. **初期データ投入**: 権限データ、テストユーザー
3. **接続テスト**: DynamoDB接続、認証テスト

### 🔧 運用フェーズ
1. **モニタリング**: CloudWatch メトリクス監視
2. **バックアップ**: Point-in-time Recovery
3. **スケーリング**: 自動スケーリング設定

## 関連リソース

### 📁 ディレクトリ構成
```
/infra
├── main.tf              # メインTerraform設定
├── dynamodb/           # DynamoDBテーブル定義
├── cognito/            # Cognito認証設定
├── s3/                 # S3バケット設定
├── iam/                # IAM権限設定
└── lambda/             # Lambda関数設定

/types
└── index.ts            # TypeScript型定義

/server/utils
├── dynamodb.ts         # DynamoDB操作ユーティリティ
└── auth.ts             # 認証ユーティリティ
```

### 🔗 外部リンク
- [AWS DynamoDB ドキュメント](https://docs.aws.amazon.com/dynamodb/)
- [AWS Cognito ドキュメント](https://docs.aws.amazon.com/cognito/)
- [Terraform DynamoDB Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table)

## 更新履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|------------|----------|--------|
| 2024-01-28 | 1.0 | 初回作成 | システム開発チーム |

## 次のステップ

### 🎯 推奨アクション
1. **インフラ構築**: `terraform apply` でAWSリソース作成
2. **接続テスト**: 開発環境でのデータベース接続確認
3. **パフォーマンステスト**: 負荷テストでスケーラビリティ確認
4. **セキュリティ監査**: IAM権限、暗号化設定の検証

### 📚 参考資料
- [システム仕様書](./system_specification.md)
- [Todoリスト](./20250728_todo.txt)
- [質問事項](./questions_for_specification.md)

---

**📧 問い合わせ**: システム開発チーム  
**🔄 最終更新**: 2024年1月28日